# DIVA-MAGs
Distribution of variants across MAGs. Script for the Microbial Metagenomics laboratory, A.Y. 2021/2022.
This script is a tool for calculation of single nucleotide variation (SNV) density in metagenome assembled genomes (MAG), and is written in Python. It accepts MAGs in fasta format as input from [InStrain](https://github.com/MrOlm/inStrain), and provides graphical representations of the average of SNV in every position in each scaffold of each MAG.
This code was developed as part of a project carried out by Sofia Fraulini, Amin Zolfaghari, Carmelo Vittorio Musumarra and Faezeh Jalali during the course of Microbial Metagenomics (Molecular Biology Master degree) at the University of Padova. The project was supervised by Prof. Stefano Campanaro, Dr. Maria Silvia Morlino, Dr. Edoardo Bizzotto and Dr. Gabriele Ghiotto.
### Python dependencies:
 Please install these Python packages:
- Pandas
- Matplotlib
- Numpy
- Os
- Argparse 
### Usage:
The user must run the program from the command line, as
python3 DIVA-MAGs.py - - files inputs.txt with inputs.txt as the required .txt file with inputs path. 

The program first ask for a path in which create the folder to store the results and then proceeds in the MAG analysis. According to the user inputs it might provide some coverage and MAG informations and asks for threshold for coverage and .txt file with windows and step values for MAGs.

In the first step for each MAG the following files are needed:
- _SNVs.tsv File generated by InStrain, containing genomic coordinates and information for each variant detected. Tab-separated.
- _scaffold_info.tsv File generated by InStrain, containing length and coverage metrics for each scaffold. Tab-separated.
- scaffold_to_bin.stb File generated by dRep, matching each scaffold to the corresponding MAG. Tab-separated.

Then make a text file. In the first line write the name of the folder that will be generated for saving the results, and write the path of each InStrain file with the above order. 
[Example for input file.](https://github.com/bioinfomics-unipd/DIVA-MAGs/blob/main/inputs%20(1).txt)

In the next step pass the text file (e.g: FILE.txt) to the `--files` option like so:

`--files FILE.txt`

Only the above command is mandatory. Some of the following commands can be handy if you want to change a default value:

For help: 

`-h, --help`

The user can ask for information on the coverage distribution to change the threshold value, by default the program uses the first quartile of the coverage distribution.
The program prints the requested information and asks the user for an integer coverage threshold for the filtering.


`--coverage_info, --c`

User can ask for MAG information to define the size of window and step for each, if not given then the program manually creates window size and step for each MAG as the ration between number of variants and MAG length multiplied by 50. The requested informations are given in the MAG_info.csv, which contain a table with MAG names, scaffold length information and variations information. After the file is created the program asks for the path of .txt file containing windows and steps decided by the user for each MAG: each row in file must refer to a MAG and must contain two tab-separated integers, window and step. Pay attention to this point that the size of the windows and steps will affect your final result and annotation.

` --window_info, --w`

Range of position to print in the final output, default is 20.

`  --printed_position`

Minimum number of variants needed to perform MAG analysis, otherwise will be discarded. Default is 20.

` --min_variants_MAG`

Minimum number of variants needed to perform scaffold analysis, otherwise discarded. Greater than 1, by default is 1.

`--min_variants_scaffold`


### Output:
The script will provide a graph of variation over positions and a table with scaffold name, position and average SNV per position for each MAG in .csv files. In each graph the involved scaffolds are shown in different colors and separated by vertical lines. The position on the x-axis do not start from 0 at each scaffold but the positions are summed. 
It also provides Filtered_scaffold.csv with the list of removed scaffold after coverage filtering, Windows.csv with windows values information and Discarded_scaffold.csv with the list of discarded scaffolds.

The script might be run on several samples and the resulted tables and graphs might be easily compare to analyze the different variation of MAGs scaffold.


